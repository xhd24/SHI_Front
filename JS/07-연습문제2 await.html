<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css
/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container mt-4">

        <div id="weather"></div>
        <input type="text">
        <button>검색</button>

        <h2>세종시 야간 약국 정보</h2>
        <div id="content">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>약국명</th>
                        <th>전화번호</th>
                        <th>주소</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>OO약국</td>
                        <td>051-1234-5678</td>
                        <td>부산광역시 해운대구 OOO</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
    <script>
        약국();//비동기
        날씨();//비동기

        function 약국() {
            const input = document.querySelector('input');
            const button = document.querySelector('button');
            button.addEventListener('click', () => {
                const search = input.value;
                getData(search);
            });
        }

        async function getData(search) {
            const url = `https://ggoreb.pythonanywhere.com/night_pharmacy/data/?search=${search}`;

            const res = await fetch(url);
            const res2 = await res.json();

            const data = res2.data;
            let html = `<table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>약국명</th>
                        <th>전화번호</th>
                        <th>주소</th>
                    </tr>
                </thead>
                <tbody>`

            //    for(const value of list.data){
            //     document.querySelector('tbody').innerHTML+=`<tr>
            //             <td>${value.name}</td>
            //             <td>${value.tel}</td>
            //             <td>${value.road_address}</td>
            //         </tr>`
            //    }

            data.forEach(value => {
                html += `<tr>
                    <td>${value.name}</td>
                    <td>${value.tel}</td>
                    <td>${value.road_address}</td>
                </tr>`
            });
            html += `</tbody>
            </table>`
            document.querySelector('#content').innerHTML = html;
        };

        async function 날씨() {
            const url = "https://api.openweathermap.org/data/2.5/weather?lat=35.1728639953646&lon=129.130680529903&units=metric&appid=6edee3c2aa182bc44d18ccb204c98a31";

            const res = await fetch(url);
            //const data = res.json();
            //fetch가 비동기여서, 이렇게 작성하면 data가 정상으로 작동하지 않음
            const res2 = await res.json();

            const desc = res2.weather[0].description;
            const icon = res2.weather[0].icon;
            const temp = res2.main.temp;
            let image = `http://openweathermap.org/img/wn/${icon}@2x.png`
            console.log(desc, icon, temp);
            const city = res2.name
            document.querySelector('#weather').innerHTML = `${city} / ${desc} / ${temp} / <img src="${image}"/>`;

        }

    </script>
</body>